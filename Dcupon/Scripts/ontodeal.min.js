var localDealUrl = "https://partner-int-api.groupon.com/deals.json?country_code=IN&limit=100&tsToken=IN_AFF_0_205459_516_0&division_id=delhi-ncr", travelDealUrl = "https://partner-int-api.groupon.com/deals.json?country_code=IN&limit=100&tsToken=IN_AFF_0_205459_516_0&lat=0.0&lng=0.0", productDealUrl = "https://partner-int-api.groupon.com/deals.json?country_code=IN&limit=100&tsToken=IN_AFF_0_205459_516_0&lat=39.7592&lng=-75.5664", specialDealsArray = ["cafe coffee day"], travelDeals = ["accommodation", "excursion", "leisure"], localDeals = ["wellness", "restaurant", "healthcare", "beauty"], productDeals = ["products__accessories1", "shoes", "home_and_garden", "products__chemist", "car", "products__sport", "womens_fashion", "fashion", "computer", "mobile_phone", "electronic", "toy", "jewellery", "mens_fashion", "print", "kitchen", "kids_fashion"], deals, offset = 0, count = 0, offsetid; $(document).ready(function () { $("body").on("click", "#loadApi", function () { offset = 0, $("#cover").addClass("covershow"); var e = 0; e++, count = 0, deals = { accommodation: [], excursion: [], leisure: [], wellness: [], restaurant: [], healthcare: [], beauty: [], products__accessories1: [], shoes: [], home_and_garden: [], products__chemist: [], car: [], products__sport: [], womens_fashion: [], fashion: [], computer: [], mobile_phone: [], electronic: [], toy: [], jewellery: [], mens_fashion: [], print: [], promocode: [], specialDeal: [], kitchen: [], kids_fashion: [] }, getGrouponDeals() }) }); var functions = { getLocalDeals: function () { offset = 0, getDeals(localDealUrl, localDeals) }, getTravelDeals: function () { offset = 0, getDeals(travelDealUrl, travelDeals) }, getProductDeals: function () { offset = 0, getDeals(productDealUrl, productDeals) } }, getDeals = function (e, o) { offsetid = "&offset=" + offset; var t = e + offsetid; $.ajax({ url: t, async: !1, cache: !1, jsonpCallback: "jsonCallback", contentType: "application/json", dataType: "jsonp" }).done(function (t) { var n = !1; dealcount = t.pagination.count, $.each(o, function (e, o) { $.each(t.deals, function (e, t) { if (n = !1, (0 == t.locations.length || t.locations.length > 1) && "promocode" != t.merchant.name.toLowerCase()) { var a = $.grep(t.tags, function (e) { return e.name.toLowerCase().indexOf(o) >= 0 }); if (a.length > 0) { var s = {}; s.title = t.title, s.discountPercent = t.priceSummary.discountPercent, s.shortAnnouncementTitle = t.shortAnnouncementTitle, s.descriptor = t.descriptor, s.dealUrl = t.dealUrl, s.merchantName = t.merchant.name, deals[o].push(s) } } }) }), $.each(t.deals, function (e, t) { if ("promocode" == t.merchant.name.toLowerCase() || t.title.toLowerCase().indexOf("use promo") >= 0 || t.title.toLowerCase().indexOf("use coupon") >= 0 || t.title.toLowerCase().indexOf("use code") >= 0 || t.pitchHtml.toLowerCase().indexOf("use promo") >= 0 || t.pitchHtml.toLowerCase().indexOf("use coupon") >= 0 || t.pitchHtml.toLowerCase().indexOf("use code") >= 0 || t.shortAnnouncementTitle.toLowerCase().indexOf("use promo") >= 0 || t.shortAnnouncementTitle.toLowerCase().indexOf("use coupon") >= 0 || t.shortAnnouncementTitle.toLowerCase().indexOf("use code") >= 0 || t.descriptor.toLowerCase().indexOf("use promo") >= 0 || t.descriptor.toLowerCase().indexOf("use coupon") >= 0 || t.descriptor.toLowerCase().indexOf("use code") >= 0) { var n = {}; n.title = t.title, n.dealUrl = t.dealUrl, n.shortAnnouncementTitle = t.shortAnnouncementTitle, n.descriptor = t.descriptor, $.each(o, function (e, o) { var a = $.grep(t.tags, function (e) { return e.name.toLowerCase().indexOf(o) >= 0 }); a.length > 0 && (n.category = o) }), void 0 == n.category && (n.category = "others"), deals.promocode.push(n) } }), e == localDealUrl && $.each(t.deals, function (e, o) { $.each(specialDealsArray, function (e, t) { if (o.merchant.name.toLowerCase() == t) { var n = {}; n.title = o.title, n.discountPercent = o.priceSummary.discountPercent, n.shortAnnouncementTitle = o.shortAnnouncementTitle, n.descriptor = o.descriptor, n.dealUrl = o.dealUrl, n.merchantName = o.merchant.name, deals.specialDeal.push(n) } }) }), dealcount > offset + 100 ? (offset += 100, getDeals(e, o)) : (count++, getGrouponDeals()) }) }, getGrouponDeals = function () { var e = Object.keys(functions); if (count < e.length) { var o = e[count]; functions[o]() } if (count == e.length) { var t = JSON.stringify(deals); t = t.replace(/\&/g, "|_|"), $.ajax({ url: "/Admin/Groupondata", type: "POST", cache: !1, data: "dealdata=" + t, success: function (e) { e === !0 ? $.ajax({ url: "/Admin/apistatusgrid", type: "post", dataType: "html", success: function (e) { $("#api_statusgrid").html(e), $("#cover").removeClass("covershow") }, error: function () { $("#myModal").modal("show"), $("#cover").removeClass("covershow") } }) : ($("#cover").removeClass("covershow"), $("#myModal").modal("show")) }, error: function () { $("#myModal").modal("show"), $("#cover").removeClass("covershow") } }) } };


